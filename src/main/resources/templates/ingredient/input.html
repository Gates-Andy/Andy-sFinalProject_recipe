<html lang="ko" xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layouts/default}">

<main layout:fragment="contents">

	<div class="mb-1">
	
		<input type="hidden" id="postId" th:value="${postId}">
		
		<input type="text" class="form-control mb-1" id="ingredientName" placeholder="재료1: ">
		
		<input type="text" class="form-control mb-1" id="ingredientAmount" placeholder="재료1의 수량: ">
		
		<label class="btn btn-style mt-3"> 재료 사진 올리기 
			<input type="file" id="fileInput" hidden> 
		</label> 
		
		<textarea class="note form-control" id="content" placeholder="추가 설명"></textarea>
		
	</div>
	
	<button type="button" class="form-control btn-style" id="savebtn">저장하기</button>

</main>

<script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>

<script layout:fragment="script">
$("#savebtn").on("click", function () {
	let postId = $("#postId").val();
	let ingredientName  = $("#ingredientName").val().trim();
	let ingredientAmount  = $("#ingredientAmount").val().trim();
	let content = $("#content").val().trim();
	let imageFile  = $("#fileInput")[0].files[0];
	
	if (ingredientName === "") {
		alert("재료 1을 입력해주세요.");
		return;
	}

	if (ingredientAmount === "") {
		alert("재료 1의 양을 입력해주세요.");
		return;
	}

	if (content === "") {
		alert("재료 손질법을 입력해주세요.");
		return;
	}

	let formData = new FormData();
	formData.append("postId", postId);
	formData.append("ingredientName", ingredientName);
	formData.append("ingredientAmount", ingredientAmount);
	formData.append("content", content);

	if (imageFile) {
		formData.append("imageFile", imageFile);
	}

	$.ajax({
		type: "post",
		url: "/ingredient/create",
		data: formData,
		enctype: "multipart/form-data",
		processData: false,
		contentType: false,
		success: function (response) {
			if (response.result === "success") {
				location.href = "/post/myRecipe/view";
			} else {
				alert("레시피 재료저장 실패.");
			}
		},
		error: function () {
			alert("레시피 재료저장 에러");
		}
	});
});
</script>