<html lang="ko" xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layouts/default}">

<main layout:fragment="contents" class="recipes">

	<div id="wrap" class="main-body">

		<div class="recipesthym" th:each="postDto : ${postDto}">

			<section class="recipes-info-left">

				<article class="myrecipe">

					<img class="menu-pic" th:src="${postDto.imagePath}" alt="완성 음식" width="100px">

					<h2 class="menu-title" th:text="${postDto.title}"></h2>

					<p class="description" th:text="${postDto.content}"></p>

					<div class="steps">
						<h3>🍽 요리 순서</h3>
						<div th:each="step : ${postDto.stepList}" class="step-box"
							style="margin-bottom: 32px;">
							<h4 th:text="'STEP ' + ${step.stepNumber}"></h4>
							<img th:src="${step.imagePath}" alt="단계 이미지"
								style="width: 100%; max-width: 500px; height: auto; border-radius: 8px; margin-bottom: 16px;" />
							<p th:text="${step.content}" style="font-size: 18px;"></p>
						</div>
					</div>

				</article>

			</section>

			<div class="recipes-info-right">

				<div class="ingredients">
					<h4>🍳 재료 목록</h4>
					<div th:each="ingredient : ${postDto.ingredientList}"
						class="ingredient-box">
						<img th:src="${ingredient.imagePath}" alt="재료 이미지">
						<div>
							<span th:text="${ingredient.ingredientName}">재료명</span> - <span
								th:text="${ingredient.ingredientAmount}">수량</span>
						</div>
					</div>
				</div>

			</div>
		</div>
		
	</div>

		<div class="icons d-flex justify-content-start align-items-center">

			<i th:unless="${postDto.liked}" class="bi bi-heart text-danger heartIcon" th:data-post-id="${postDto.id}"></i>
			<i th:if="${postDto.liked}" class="bi bi-heart-fill text-danger heartIcon" th:data-post-id="${postDto.id}"></i>
			<span th:text="${postDto.likeCount}"></span>
			
			<input type="text" class="form-control col-10" placeholder="댓글을 등록 해주세요">
			<!-- 댓글 입력 ajax 보내기 -->
			<button type="button" class="form-control col-1">등록</button>
			<!-- 댓글 입력 ajax 보내기 -->
		</div>
		
		<div class="">
			<div>사용자1 : 정말 최고에요 </div>
			<div>사용자2 : 역시나		</div>	
			<div>사용자3 : 정말 웩이에요 </div>
			<div>사용자4 : 존시나		</div>	
		</div>
</main>

<script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>

<script layout:fragment="script">

	$(".heartIcon").on("click", function() {
		
	     let postId = $(this).data("post-id");

		$.ajax({
			type : "post",
			url : "/post/like",
			data : {
				"postId" : postId
			},
			success : function(response) {
				if (response.result == "success") {
					location.reload();
				} else {
					alert("좋아요 실패!!!");
				}
			},
			error : function() {
				alert("좋아요 애러!!!");
			}
		});
	});
</script>
</html>