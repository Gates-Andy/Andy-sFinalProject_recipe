<html lang="ko" xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layouts/default}">

<main layout:fragment="contents">

	<div class="type-box d-flex justify-content-between align-items-center">
		<label class="create-title">레시피 이름 : <input type="text" id="titleInput" placeholder="레시피 이름을 꼭 넣어주세요"></label> 
		<label class="create-headcount">인원수 추가 : <input type="number" id="headcountInput" placeholder="인원수를 꼭 넣어주세요"></label> 
		<label class="create-category">레시피 카테고리 : <input type="text" id="categoryInput" placeholder="레시피 카테고리를 꼭 넣어주세요">
		</label>
	</div>

	<div class="content">
		<label>레시피 설명 : </label>
		<textarea class="form-control" id="contentInput" placeholder="요리 설명을 해보아요"></textarea>
	</div>
	
	<!-- 
	<div class="d-flex justify-content-center align-items-center">
		<button type="button" class="btn-imginput btn btn-secondary" id="imginputbtn">사진 첨부</button>
	</div>
	 -->
	 
	<div class="upload-section d-flex justify-content-end mr-5">
		<label class="btn-imginput btn btn-secondary">
			<input type="file" id="fileInput" name="imageFile" hidden> 사진 첨부
		</label> 
		<span id="fileName"></span>
		<img class="mt-2" id="previewImg1" src="#" alt="미리보기" style="display:none; max-width:100px; margin-left:10px;">
	</div>
			
	<div class="function d-flex justify-content-center">
		<button type="button" class="btn-save btn btn-primary form-control col-4" id="savebtn">MyRecipe에 저장</button>
	</div>

</main>

<script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>

<script layout:fragment="script">
function previewImage(input, previewId) {
	  if (input.files && input.files[0]) {
	    const reader = new FileReader();
	    reader.onload = function(e) {
	      $('#' + previewId).attr('src', e.target.result).show();
	    };
	    reader.readAsDataURL(input.files[0]);
	  }
	}

	$('#fileInput').on('change', function() {
	  previewImage(this, 'previewImg1');
	});

$("#savebtn").on("click", function () {
	let title = $("#titleInput").val();
	let headcount = $("#headcountInput").val();
	let category = $("#categoryInput").val();
	let content = $("#contentInput").val();
	let file = $("#fileInput")[0].files[0];
	
	if (title === "") {
		alert("레시피 이름을 입력해주세요.");
		return;
	}

	if (category === "") {
		alert("카테고리를 입력해주세요.");
		return;
	}

	if (!headcount || isNaN(headcount)) {
		alert("인원수를 올바르게 입력해주세요.");
		return;
	}

	if (content === "") {
		alert("요리 설명을 입력해주세요.");
		return;
	}

	let formData = new FormData();
	formData.append("title", title);
	formData.append("headcount", headcount);
	formData.append("category", category);
	formData.append("content", content);
	
	if (file) {
		formData.append("imageFile", file);
	}

	$.ajax({
		type: "post",
		url: "/post/create",
		data: formData,
		enctype: "multipart/form-data",
		processData: false,
		contentType: false,
		success: function (response) {
			if (response.result === "success") {
				location.href = "/post/myRecipe/view";
			} else {
				alert("레시피 저장 실패.");
			}
		},
		error: function () {
			alert("레시피 저장 에러");
		}
	});
});

</script>
</body>
</html>